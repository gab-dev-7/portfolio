---
import { Icon } from 'astro-icon/components'
// CRITICAL: We remove all "import 'ninja-keys'" statements that cause the build error.
// The package is now loaded globally via the CDN link in Layout.astro.
---

<div id="ninja-keys-wrapper">
    <ninja-keys placeholder="Search commands..." hide-breadcrumbs></ninja-keys>
</div>

<script>
  // Access the element as a custom component
  const ninja = document.querySelector('ninja-keys') as any; 

  if (ninja) {
        ninja.data = [
            {
                id: 'nav',
                title: 'Navigation',
                hotkey: 'cmd+n',
                icon: 'mdi:compass-outline',
                section: 'Navigation',
                children: [
                    { id: 'home', title: 'Go to Home', icon: 'mdi:home', handler: () => window.location.href = '/' },
                    { id: 'neovim', title: 'Neovim Mode', icon: 'mdi:console', handler: () => window.location.href = '/neovim' },
                ]
            },
            {
                id: 'actions',
                title: 'Actions',
                hotkey: 'cmd+a',
                icon: 'mdi:lightning-bolt',
                section: 'Actions',
                children: [
                    { 
                        id: 'theme', 
                        title: 'Toggle Theme (Light/Dark)', 
                        icon: 'mdi:theme-light-dark', 
                        hotkey: 'cmd+t',
                        handler: () => {
                            window.dispatchEvent(new CustomEvent('theme-toggle'));
                        }
                    },
                    { 
                        id: 'email', 
                        title: 'Email Me', 
                        icon: 'mdi:email', 
                        handler: () => {
                            window.open('mailto:gawindlin@gmail.com', '_blank');
                        }
                    },
                    { 
                        id: 'cv', 
                        title: 'Download CV', 
                        icon: 'mdi:file-pdf-box', 
                        handler: () => {
                            const link = document.createElement('a');
                            link.href = '/cv.pdf'; // Points to public/cv.pdf
                            link.download = 'Gabriel_Windlin_CV.pdf';
                            link.click();
                        }
                    }
                ]
            },
        ];
  }

  // Open palette when the visible button is clicked (Listen for the button click)
  // This logic is correct and relies on the global availability.
  window.addEventListener('open-palette', () => {
        const ninja = document.querySelector('ninja-keys') as any;
        // The timeout is a necessary safeguard for client-side custom component loading
        setTimeout(() => {
          if (ninja) ninja.open();
        }, 50); 
  });

  // Re-add the global key listener for Ctrl+K / Cmd+K
  document.addEventListener('keydown', (e) => {
    if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
        e.preventDefault();
        const ninja = document.querySelector('ninja-keys') as any;
        // Use timeout here as well
        setTimeout(() => {
            if (ninja) ninja.open();
        }, 50);
    }
  });
</script>

<style>
    /* Styling remains the same */
    ninja-keys {
        --ninja-accent-color: rgb(0, 242, 255); 
        --ninja-background: rgb(5, 10, 20); 
        --ninja-secondary-background: rgb(26, 32, 44);
        --ninja-text-color: rgb(230, 241, 255);
        --ninja-footer-background: rgb(15, 23, 42);
        --ninja-selected-background: rgb(26, 32, 44);
        --ninja-icon-color: rgb(0, 242, 255);
        font-family: 'JetBrains Mono', monospace;
        z-index: 99999;
    }
</style>
